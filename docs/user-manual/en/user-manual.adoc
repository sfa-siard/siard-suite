include::../../theme/config.adoc[]
:toc-title: Table of contents
= Siard Suite Manual

== Introduction

The SIARD (Software-Independent Archival of Relational Databases) standard defines a format to archive contents of relational databases in the long term. The "SIARD Suite" application provides a graphical user interface for archiving, restoring, searching and exporting SIARD archives.

== Context

In collaboration with the EU project E-ARK and KOST, version 2.1 of the SIARD format was specified between 2015 and 2018. Like version 1.0 before, SIARD format 2.1 was homologated as standard eCH-0165 by the association "eCH E-Government Standards". In 2021, the DILCIS Board developed and approved the extended SIARD Format 2.2.

SIARD Suite is the reference implementation for archiving relational databases in the standardized SIARD format 2.2. Furthermore, SIARD Suite can also read SIARD archives in the SIARD 2.1 and SIARD 1.0 formats and convert them to SIARD 2.2.

== About this document

This document provides a brief overview of the application and its use. A detailed manual in English is available on the project website of the Swiss Federal Archives: https://www.bar.admin.ch/bar/en/home/archiving/tools/siard-suite.html

== System requirements and installation

The SIARD Suite application is a Java FX application. As such, it can basically run on any system where a Java Runtime Environment 8 (JRE) with the JavaFX extension is installed.

In addition, there are distributions with JRE included as well as native installers for Windows, Mac and Linux, so that no JRE needs to be installed on the system.

Each distribution is listed below. All distributions can be downloaded from https://github.com/sfa-siard/siard-suite/releases.


|===
|Distribution Name | Description

|SIARD-Suite-v2.2.133
|Distribution without runtime, requires JRE with JavaFX installed on the system
|SIARD-Suite-v2.2.133-Linux
|Distribution with included runtime for Linux
|SIARD-Suite-v2.2.133-Windows
|Distribution with included runtime for Windows
|SIARD-Suite-v2.2.133-macOS
|Distribution with included runtime for MacOS
|SIARD-Suite-v2.2.133-Linux-deb
|Native installer for Linux
|SIARD-Suite-v2.2.133-win-exe
|Native installer for Windows (exe)
|SIARD-Suite-v2.2.133-win-msi
|Native installer for Windows (msi)
|SIARD-Suite-v2.2.133-macOS-dmg
||Native installer for MacOS
|===

*Note:* When using the native installer, the Siard CLI (Command Line Interface) is not available. To use the CLI, a distribution with or without an included JRE should be used.

=== Installing and Running the Application

When using the native installers, the installation is simply done through the system. If necessary, administrator privileges are used for this. The installers also create the appropriate shortcuts to start the application.

The distributions with and without JRE are delivered as a ZIP archive. This can be unpacked anywhere. After that the application can be started by one of the start scripts:

|===
| script name | description

| siard-suite (.bat) | Start the graphical user interface for Unix or Windows systems
| siard-from-db (.bat) | Archiving a database (CLI)
| siard-to-db (.bat) | Upload a SIARD archive to a database (CLI)
|===


== Using the SIARD Suite

The SIARD Suite is composed of the following components

* Graphical user interface (GUI)
* SiardFromDb (CLI)
* SiardToDB (CLI)

The purpose and the use of these components are explained below.

=== SIARD Suite GUI

The GUI is the central application to create SIARD archives and to view them later without modifying the primary data of the archive. For complex analysis of the archived data, the archive should be reloaded into a database.

The start screen is the entry point to the application. The four main functionalities of the application can be initiated from here:


image::startscreen.png[]


* Archive database
* Open SIARD archive
* Upload a SIARD archive to a database
* Export data from a SIARD database

The application guides the user through the different operations.

==== Archiving Databases with Binary Data

The SIARD Format 2.2 standard specifies that large objects (LOBs) of a database can be stored in the external file system.

The location of the data can be recorded during archiving in the "metadata" step.

image::metadata.png[]

The path can be absolute as a file URI (`file:/`) or relative, e.g. `../lobs/` - in either case the path must end with a slash (`/`). It is recommended to use relative paths so that the archive can be moved along with the external LOB data - this is not possible if absolute paths are used.
The structure within the specified folder is then automatically generated and follows the structure of the database: `schema/table/column`. SIARD Suite automatically detects the MIME type and the file extensions are automatically set correctly. This also allows the binary files to be opened directly from SIARD Suite in the correct application installed on the system.

==== Settings

Under the menu item "Options" you can configure the application.

image::options.png[]

The following settings are available:

|===
| Option | Description
| Login Timeout (s) | Maximum time to wait for a database connection (in seconds). 0 for unlimited
| Query Timeout (s) | Maximum time to wait for a database query (0 for unlimited).
|===

=== SIARD Suite CLI

In addition to the graphical user interface, databases can also be archived or an archive can be read back into a database via the command line.

For this purpose the scripts `siard-from-db` and `siard-to-db` are available in the ZIP distribution.

=== SiardFromDb

With `siard-from-db` a database can be archived without using the GUI.

==== Usage

In a terminal, change to the directory where the ZIP archive was unpacked, open the directory `bin` there and execute it with

```
siard-from-db [-h] | [-o] [-v] [-l=<login timeout>] [-q=<query timeout>] [-i=<import meta data>] [-x=<external lob folder>] [-m=<mime type>] -j=<JDBC URL> -u=<database user> -p=<database password> -s=<siard file> -e=<export meta data>"
```

==== Arguments

|===
| argument | description

| -o | Overwrite output file(s) if available
| -v | archive views as tables
| <login timeout> | login timeout in seconds (0 for unlimited)
| <query timeout> | query timeout in seconds (0 for unlimited)
| <import metadata> | name of the metadata XML file to use as template
| <external LOB folder> | Folder where the data of the largest LOB (large object) column of the database should be stored externally (contents with the same name will be overwritten!)
| <mime type> | MIME type of the data of the largest LOB column of the database (influences the choice of the name extension of the externally stored LOBs)
| <JDBC URL> | JDBC URL of the database to be downloaded.

Examples:

*MS Access:* jdbc:access:<path>/<filename>.mdb

*DB/2:* jdbc:<host>:50000/<db-name>

*MySQL:* jdbc:mysql://<host>:3306/<db-name>

*Oracle:*
jdbc:oracle:thin:@<host>:1521:orcl

*postgres:*
jdbc:postgresql://<host>:5432/<db-name>

*SQL server:*
jdbc:sqlserver://<host>/<db-name>:1433
| <database user> | database user
| <database password> | database password
| <siard file> | name of the .siard file to create
| <export metadata> | name of the .xml metadata file to export
|===

==== Notes

At least one of the two parameters `siard-file` or `export metadata` must be set (it is also possible to use both parameters).

__Note: The contents of the database should not be changed during the archiving process - use a snapshot of the database if necessary.__

The option Archive views as tables usually leads to redundant storage of the same data and is therefore not recommended. It is useful if the database user used for archiving can see the contents of the views but not the base tables.

The archiving operation is either completely successful or fails.

For large databases, it is recommended to download the metadata XML first. This contains all the metadata and table sizes and helps to estimate the execution time required for the download. Also, for large tables, the -q 0 option should be used, as it is not possible to estimate how many seconds a size query will take.

==== Database user

It is generally not recommended to use the database administrator (DBA, root, dbo, ...) with all rights to download a SIARD archive. The scope of the data stored in the SIARD archive is defined by the objects to which the archive user has read access. The global DBA can usually read all databases on the system, plus many system tables that should not be archived. For this reason, it is important to use a suitable archive user for the download, which may need to be created for this purpose.

=== SiardToDb

SiardToDb is a command line program that loads a SIARD archive into a database instance for retrieval.

==== Usage

```shell
siard-to-db [-h] [-o] [-l=<login timeout>] [-q=<query timeout>] -s=<siard-file> -j=<JDBC-URL> -u=<database user> -p=<database password [<schema> <mappedschema>]
```

==== arguments

|===
| argument | description

|-o | overwrite identically named types and/or tables in the database, if any
| <login timeout> | timeout in seconds for login (0 for unlimited)
| <query timeout> | query timeout in seconds (0 for unlimited)
| <siard file> | name of the .siard file to upload
| <JDBC URL> | JDBC URL of the target database
Examples:

*MS Access:* jdbc:access:<path>/<file name>.mdb

*DB/2:* jdbc:<host>:50000/<db-name>

*MySQL:* jdbc:mysql://dbserver.enterag.ch:3306/<db-name>

*Oracle:* jdbc:oracle:thin:@<host>:1521:orcl

*postgres:* jdbc:postgres://<host>:5432/<db-name>

*SQL server:* jdbc:sqlserver://<host>\<db-name>:1433

| <database user> | database user
| <database password> | database password
| <schema> | name of the schema in the SIARD archive
| <mappedschema> | name of the schema to be used in the database
|===

==== Notes

Since older databases are not SQL:2008 compliant, some manual preparation for upload is inevitable. There are no schema objects in MS Access. In Oracle, users and schemas are inseparable. In MySQL, schema objects and databases are one and the same. Therefore, all schemas must be created manually before uploading. In addition, the database user must have the right to create tables and types in these schemas. Since this is not always easy, the database schemas are mapped to the schema names according to the mapping list on the command line.

The upload only creates tables and types and tries to activate primary and foreign keys. No other objects are created in the target database. If the keys cannot be activated, a warning is issued, but the upload is still considered successful. SQL SELECT queries on the database can be executed even without these keys.

There may also be limitations when uploading. With MS Access, all tables end up in the same MDB/ACCDB. With Oracle, all names longer than 30 characters are truncated. To avoid collisions, table and column names are given a counter. (For example, "A table name that is way too long for Oracle" becomes "A table name that is Table01").

If the maximum precision and the maximum number of decimal places (e.g. in MS Access) are less than required, the values are uploaded with less precision. SIARD helps itself as much as possible in the target database system. If the metadata of the database is consulted with SiardGui, the correct labels and values can be assigned.

== Tips and Tricks

=== Preparing a database for download

SIARD Suite downloads all the data visible to the database user used for the connection. The choice of a suitable database user therefore determines the size of the archived database. Often a suitable "technical database user" of a database application is available, which is used to manage the database. This user usually has exactly the access rights needed to archive the database.

However, if such a database user is not available, the database administrator (DBA, dbo, root, SYSTEM, sa, ...) should not be used for the download. This is because this user has read access to many system tables and tables from other databases that are not to be archived. Instead, it is recommended that a database user be created for archiving. This archiving user must have read access to all schemas, tables, views and types belonging to the database to be archived. Refer to your DBMS documentation for information on how to create a user and grant it the necessary privileges.

Once a suitable user has been found or created, the database download can be performed using the user's credentials.

=== Preparing a database for upload

To upload a database to an instance of a DBMS with SIARD Suite, suitable database schemas must be available in the target database. These schemas can then be mapped to the schemas in the SIARD archive in the schema mapping of the upload dialog (or in the schema mapping of the SiardToDb command line).

Ideally, the target schemas should be empty. However, depending on the DBMS security settings, it is not always possible to create or select schemas at will. If the target schemas are not empty, the archived data will only be uploaded if either there are no name collisions for the types and tables, or the Overwrite option has been explicitly selected.

The database user whose credentials are used for the upload must have the right to create types and tables in the target schemas and to insert data into these tables. Refer to your DBMS documentation for information on how to create schemas and give the database user the necessary rights. The easiest way, if possible, is to use the credentials of the database administrator. This is because the database administrator usually has all the necessary privileges. In this case, however, the Overwrite option should not be selected. Otherwise, the risk of overwriting important tables or types in the system is too great.

=== Time, Timestamps and Time Zones.

The conversion of TIMES and TIMESTAMPS in the database depends on the local time zone. The UTC time 14:30 in the SIARD archive is loaded into the database as local time 15:30 when uploading in Zurich - in winter. To suppress this conversion, SiardToDb must be started with the option `-Duser.timezone=GMT`, which causes SIARD to interpret all database times as UTC times.

== Restrictions

The SIARD format has the following limitations

* The size of a SIARD file must not exceed 18'446'744'073'709'551'615 bytes (about 18 ExaBytes) (ZIP64 limitation).
* The number of files (tables and LOB) must not exceed 4'294'967'295 (about 4 billion) (ZIP64 limitation).

The SIARD Suite is also limited by

* All the metadata of the database must fit in the JAVA memory (heap). This limitation can occur with an unfavorable constellation of available main memory and complexity of the database metadata. It can be circumvented by starting the SIARD applications on a machine with sufficient main memory and, if necessary, enlarging the JAVA heap with the JAVA command line parameter -Xmx2000m or a similar parameter on the JAVA command line.